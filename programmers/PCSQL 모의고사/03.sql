USE programmers_mockTest;

CREATE TABLE RESERVATION (
	ID INT PRIMARY KEY NOT NULL,
    USER_ID INT NOT NULL,
    START_TIME DATETIME NOT NULL,
    END_TIME DATETIME NOT NULL
);

INSERT INTO RESERVATION (ID, USER_ID, START_TIME, END_TIME) VALUES 
(1, 101, '2024-01-10 13:00:00', '2024-01-10 15:00:00'),
(2, 201, '2024-01-10 15:00:00', '2024-01-10 18:00:00'),
(3, 101, '2024-01-10 17:00:00', '2024-01-10 23:00:00'),
(4, 301, '2024-01-10 19:00:00', '2024-01-10 20:00:00'),
(5, 401, '2024-01-11 09:00:00', '2024-01-11 11:00:00'),
(6, 301, '2024-01-11 08:00:00', '2024-01-11 12:00:00');

SELECT * FROM RESERVATION;

WITH SB AS (
    SELECT
        ID,
        START_TIME,
        END_TIME,
        LAG(END_TIME) OVER (ORDER BY ID) AS PREVIOUS_END_TIME
    FROM RESERVATION
)

SELECT
    ID,
    START_TIME,
    END_TIME
FROM SB
WHERE PREVIOUS_END_TIME IS NULL OR PREVIOUS_END_TIME <= START_TIME
ORDER BY 2 ASC