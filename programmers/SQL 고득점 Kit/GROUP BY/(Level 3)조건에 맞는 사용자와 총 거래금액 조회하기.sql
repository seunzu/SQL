USE programmers_groupBy;

SHOW TABLES;

CREATE TABLE USED_GOODS_BOARD (
	BOARD_ID VARCHAR(5) PRIMARY KEY NOT NULL,
    WRITER_ID VARCHAR(50) NOT NULL,
    TITLE VARCHAR(100) NOT NULL,
    CONTENTS VARCHAR(1000) NOT NULL,
    PRICE INTEGER NOT NULL,
    CREATED_DATE DATE NOT NULL,
    STATUS VARCHAR(10) NOT NULL,
    VIEWS INTEGER NOT NULL
);

CREATE TABLE USED_GOODS_USER (
	USER_ID VARCHAR(50) PRIMARY KEY NOT NULL,
    NICKNAME VARCHAR(100) NOT NULL,
    CITY VARCHAR(100) NOT NULL,
    STREET_ADDRESS1 VARCHAR(100) NOT NULL,
    STREET_ADDRESS2 VARCHAR(100),
    TLNO VARCHAR(20) NOT NULL
);


INSERT INTO USED_GOODS_BOARD (BOARD_ID, WRITER_ID, TITLE, CONTENTS, PRICE, CREATED_DATE, STATUS, VIEWS)
VALUES 
('B0001', 'zkzkdh1', '캠핑의자', '가벼워요 깨끗한 상태입니다. 2개', 25000, '2022-11-29', 'SALE', 34),
('B0002', 'miyeon89', '벽걸이 에어컨', '엘지 휘센 7평', 100000, '2022-11-29', 'SALE', 55),
('B0003', 'dhfkzmf09', '에어팟 맥스', '에어팟 맥스 스카이 블루 색상 판매합니다.', 450000, '2022-11-26', 'DONE', 67),
('B0004', 'sangjune1', '파파야나인 포르쉐 푸쉬카', '예민하신분은 피해주세요', 30000, '2022-11-30', 'DONE', 78),
('B0005', 'zkzkdh1', '애플워치7', '애플워치7 실버 스텐 45미리 판매합니다.', 700000, '2022-11-30', 'DONE', 99);

INSERT INTO USED_GOODS_USER (USER_ID, NICKNAME, CITY, STREET_ADDRESS1, STREET_ADDRESS2, TLNO)
VALUES 
('cjfwls91', '점심만금식', '성남시', '분당구 내정로 185', '501호', '01036344964'),
('zkzkdh1', '후후후', '성남시', '분당구 내정로 35', '가동 1202호', '01032777543'),
('spdlqj12', '크크큭', '성남시', '분당구 수내로 206', '2019동 801호', '01087234922'),
('xlqpfh2', '잉여킹', '성남시', '분당구 수내로 1', '001-004', '01064534911'),
('dhfkzmf09', '찐찐', '성남시', '분당구 수내로 13', 'A동 1107호', '01053422914');

SELECT * FROM USED_GOODS_BOARD;

SELECT * FROM USED_GOODS_USER;

-- 1
SELECT 
    B.USER_ID, B.NICKNAME, SUM(A.PRICE) AS TOTAL_SALES
FROM
    USED_GOODS_BOARD AS A
        JOIN
    USED_GOODS_USER AS B ON (WRITER_ID = USER_ID)
WHERE
    A.STATUS = 'DONE'
GROUP BY B.USER_ID
HAVING TOTAL_SALES >= 700000
ORDER BY TOTAL_SALES ASC;

-- 2
WITH SB AS (
	SELECT 
		WRITER_ID, SUM(PRICE) AS TOTAL_SALES
	FROM 
		USED_GOODS_BOARD
	WHERE
		STATUS = 'DONE'
	GROUP BY 
		WRITER_ID
)

SELECT
	B.USER_ID,
    B.NICKNAME,
    C.TOTAL_SALES
FROM
	USED_GOODS_USER B,
    SB C
WHERE
	B.USER_ID = C.WRITER_ID 
    AND C.TOTAL_SALES >= 700000
ORDER BY
	C.TOTAL_SALES;
