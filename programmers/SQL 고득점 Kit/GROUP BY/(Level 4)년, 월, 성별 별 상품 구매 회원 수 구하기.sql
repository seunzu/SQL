USE programmers_groupBy;

SHOW TABLES;

CREATE TABLE USER_INFO (
	USER_ID INTEGER PRIMARY KEY NOT NULL,
    GENDER TINYINT(1),
    AGE INTEGER,
    JOINED DATE NOT NULL
);

CREATE TABLE ONLINE_SALE (
	ONLINE_SALE_ID INTEGER PRIMARY KEY NOT NULL,
    USER_ID INTEGER NOT NULL,
    PRODUCT_ID INTEGER NOT NULL,
    SALES_AMOUNT INTEGER NOT NULL,
    SALES_DATE DATE NOT NULL
);

INSERT INTO USER_INFO (USER_ID, GENDER, AGE, JOINED) 
VALUES 
(1, 1, 26, '2021-06-01'),
(2, NULL, NULL, '2021-06-25'),
(3, 0, NULL, '2021-06-30'),
(4, 0, 31, '2021-07-03'),
(5, 1, 25, '2021-07-09'),
(6, 1, 33, '2021-07-14');

INSERT INTO ONLINE_SALE (ONLINE_SALE_ID, USER_ID, PRODUCT_ID, SALES_AMOUNT, SALES_DATE) 
VALUES 
(1, 1, 54, 1, '2022-01-01'),
(2, 1, 3, 2, '2022-01-25'),
(3, 4, 34, 1, '2022-01-30'),
(4, 6, 253, 3, '2022-02-03'),
(5, 2, 31, 2, '2022-02-09'),
(6, 5, 35, 1, '2022-02-14'),
(7, 5, 57, 1, '2022-02-18');

SELECT * FROM USER_INFO;

SELECT * FROM ONLINE_SALE;

SELECT 
    YEAR(SALES_DATE) AS YEAR,
    MONTH(SALES_DATE) AS MONTH,
    GENDER,
    COUNT(DISTINCT USER_ID) AS USERS
FROM
    USER_INFO
        JOIN
    ONLINE_SALE USING (USER_ID)
WHERE
    GENDER IS NOT NULL
GROUP BY 1 , 2 , 3
ORDER BY 1 , 2 , 3;


